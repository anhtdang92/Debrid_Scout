{% extends "base.html" %}

{% block title %}RD Manager{% endblock %}

{% block content %}
<h2>RD Manager</h2>
<p class="subtitle">Manage your Real-Debrid torrents</p>

{% if torrents %}
<!-- Toolbar -->
<div class="toolbar">
    <button class="delete-selected-button" data-action="delete-selected" aria-label="Delete All Selected Torrents">
        <i class="fa-solid fa-trash"></i> Delete Selected
    </button>
</div>

<table class="rd-manager-table">
    <thead>
        <tr>
            <th style="width: 60px;">
                <input type="checkbox" id="select-all" data-action="toggle-select-all" aria-label="Select All">
            </th>
            <th>Torrent Name</th>
            <th style="width: 160px;">Status</th>
            <th style="width: 200px;">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for torrent in torrents %}
        <tr>
            <td>
                <input type="checkbox" class="torrent-checkbox" value="{{ torrent.id }}"
                    aria-label="Select {{ torrent.filename or 'Unknown' }}">
            </td>
            <td>{{ torrent.filename or 'Unknown Filename' }}</td>
            <td>
                {% if torrent.status == "downloaded" %}
                <i class="fa-solid fa-check-circle downloaded-check" title="Downloaded"></i>
                {% elif torrent.status in ["error", "magnet_error", "virus", "dead"] %}
                <span class="status-error">
                    {% if torrent.status == "virus" %}
                    <i class="fa-solid fa-skull-crossbones"></i> Virus
                    {% elif torrent.status == "dead" %}
                    <i class="fa-solid fa-skull"></i> Dead
                    {% elif torrent.status == "magnet_error" %}
                    <i class="fa-solid fa-link-slash"></i> Magnet Error
                    {% else %}
                    <i class="fa-solid fa-circle-exclamation"></i> Error
                    {% endif %}
                </span>
                {% elif torrent.status == "downloading" %}
                <span class="status-progress">
                    <i class="fa-solid fa-spinner fa-spin"></i> {{ torrent.progress }}%
                </span>
                {% else %}
                <span class="status-progress">
                    <i class="fa-solid fa-clock"></i> {{ torrent.status | title }}
                </span>
                {% endif %}
            </td>
            <td>
                <div class="button-group">
                    <button class="button" data-action="show-files" data-id="{{ torrent.id }}"
                        aria-label="Show Files">
                        <i class="fa-solid fa-folder-open"></i> Files
                    </button>
                    <button class="delete-button" data-action="confirm-delete" data-id="{{ torrent.id }}"
                        aria-label="Delete" title="Delete Torrent">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination -->
<div class="pagination">
    {% if current_page > 1 %}
    <a href="{{ url_for('torrent.rd_manager', page=current_page - 1) }}" class="pagination-link"
        aria-label="Previous">
        <i class="fa-solid fa-chevron-left"></i>
    </a>
    {% endif %}

    {% for page_num in range(1, total_pages + 1) %}
    {% if page_num == current_page %}
    <span class="pagination-link active" aria-current="page">{{ page_num }}</span>
    {% else %}
    <a href="{{ url_for('torrent.rd_manager', page=page_num) }}" class="pagination-link">{{ page_num }}</a>
    {% endif %}
    {% endfor %}

    {% if current_page < total_pages %}
    <a href="{{ url_for('torrent.rd_manager', page=current_page + 1) }}" class="pagination-link"
        aria-label="Next">
        <i class="fa-solid fa-chevron-right"></i>
    </a>
    {% endif %}
</div>
{% else %}
<div class="hs-empty">
    <i class="fa-solid fa-inbox"></i>
    <p>No torrents available.</p>
</div>
{% endif %}

<!-- RD Manager Modal -->
<div class="rd-modal" id="rdModal">
    <div class="rd-modal-content">
        <span class="rd-close" data-action="close-modal" data-id="rdModal">&times;</span>
        <h3 id="modal-files-title">Files in Torrent</h3>
        <ul id="files-list">
        </ul>
    </div>
</div>
{% endblock %}
