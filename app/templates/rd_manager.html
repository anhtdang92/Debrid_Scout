{% extends "base.html" %}

{% block title %}RD Manager{% endblock %}

{% block content %}
<h2>RD Manager</h2>
<p class="subtitle">Manage your Real-Debrid torrents below:</p>

{% if torrents %}
<!-- Toolbar -->
<div class="toolbar">
    <button class="delete-selected-button" data-action="delete-selected" aria-label="Delete All Selected Torrents">
        <i class="fa-solid fa-trash"></i> Delete Selected
    </button>
</div>

<table class="rd-manager-table">
    <thead>
        <tr>
            <th>
                <input type="checkbox" id="select-all" data-action="toggle-select-all" aria-label="Select All Torrents">
                Select All
            </th>
            <th>Torrent Name</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for torrent in torrents %}
        <tr>
            <td>
                <input type="checkbox" class="torrent-checkbox" value="{{ torrent.id }}"
                    aria-label="Select Torrent {{ torrent.filename or 'Unknown Filename' }}">
            </td>
            <td>{{ torrent.filename or 'Unknown Filename' }}</td>
            <td>
                {% if torrent.status == "downloaded" %}
                <i class="fa-solid fa-check downloaded-check" title="Downloaded" aria-label="Downloaded"></i>
                {% else %}
                <i class="fa-solid fa-question" title="Status Unknown" aria-label="Status Unknown"></i>
                {% endif %}
            </td>
            <td>
                <div class="button-group">
                    <button class="button" data-action="show-files" data-id="{{ torrent.id }}"
                        aria-label="Show Files for {{ torrent.filename or 'Unknown Filename' }}">
                        <i class="fa-solid fa-folder"></i> Files
                    </button>
                    <button class="delete-button" data-action="confirm-delete" data-id="{{ torrent.id }}"
                        aria-label="Delete Torrent {{ torrent.filename or 'Unknown Filename' }}" title="Delete Torrent">
                        <i class="fa-solid fa-trash"></i> Delete
                    </button>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination -->
<div class="pagination">
    {% if current_page > 1 %}
    <a href="{{ url_for('torrent.rd_manager', page=current_page - 1) }}" class="pagination-link"
        aria-label="Previous Page">Previous</a>
    {% endif %}

    {% for page_num in range(1, total_pages + 1) %}
    {% if page_num == current_page %}
    <span class="pagination-link active" aria-current="page">{{ page_num }}</span>
    {% else %}
    <a href="{{ url_for('torrent.rd_manager', page=page_num) }}" class="pagination-link">{{ page_num }}</a>
    {% endif %}
    {% endfor %}

    {% if current_page < total_pages %} <a href="{{ url_for('torrent.rd_manager', page=current_page + 1) }}"
        class="pagination-link" aria-label="Next Page">Next</a>
        {% endif %}
</div>
{% else %}
<p>No torrents available.</p>
{% endif %}

<!-- RD Manager Modal -->
<div class="rd-modal" id="rdModal">
    <div class="rd-modal-content">
        <span class="rd-close" data-action="close-modal" data-id="rdModal">&times;</span>
        <h3 id="modal-files-title">Files in Torrent</h3>
        <ul id="files-list">
            <!-- Files will be dynamically loaded here -->
        </ul>
    </div>
</div>
{% endblock %}